# Анализатор тематики мероприятий

Данный документ содержит описание работы и информацию о развертке микросервиса предназначенного для вычленения ключевых слов из заданного набора (тэгов) по текстовому описанию мероприятия.

Название: `event_theme_analyzer`

Структура сервиса:

| Файл                       | Описание                                                |
| -------------------------- | ------------------------------------------------------- |
| `event_theme_analyzer.py`  | Код микросервиса                                        |
| `config.yml`               | Конфигурационный файл со строкой подключения к RabbitMQ |
| `run.sh`                   | Файл для запуска сервиса из Docker контейнера           |
| `requirements.txt`         | Верхнеуровневые зависимости                             |
| `requirements.lock`        | Все зависимости (`pip freeze`)                          |
| `Dockerfile`               | Описание сборки контейнера сервиса                      |
| `docker-compose.yml`       | Изолированная развертка сервиса вместе с RabbitMQ       |
| `docker-compose.local.yml` | Развертка зависимостей для дебаггинга RabbitMQ          |
| `.rest`                    | Тесты взаимодействия с HTTP эндпоинтами микросервиса    |
| `README.md`                | Описание микросервиса                                   |

## API

### RPC

Проанализировать мероприятие и добавить к нему тэги:

```bat
n.rpc.event_theme_analyzer.analyze_events(events)

Args: events = [event_1, ..., event_m]
Returns: list of the events with 'tags' field added
```

### HTTP

Новая анкета или обновление данных по анкете:

```rst
POST http://localhost:8000/analyze HTTP/1.1
Content-Type: application/json

'... a description of the event ...'
```

Препроцессинг мероприятия:

```rst
GET http://localhost:8000/preprocess HTTP/1.1
```

## Развертывание и запуск

### Локальный запуск

Для локального запуска микросервиса требуется запустить контейнер с RabbitMQ. Для этого есть специальный `docker-compose.local.yml`. Чтобы запустить:

```bat
docker-compose --file docker-compose.local.yml up -d
```

Затем из папки микросервиса вызвать

```bat
nameko run event_theme_analyzer
```

Для проверки `rpc` запустите в командной строке:

```bat
nameko shell
```

После чего откроется интерактивная Python среда. Обратитесь к сервису одной из команд, представленных выше в разделе `rpc`

### Запуск в контейнере

Чтобы запустить микросервис в контейнере вызовите команду:

```bat
docker-compose up
```

> если вы не хотите просмотривать логи, добавьте флаг `-d` в конце

Микросервис запустится вместе с RabbitMQ в контейнере.
